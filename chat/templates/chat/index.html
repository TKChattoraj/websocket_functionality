{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>LN Open Channel simulation</title>
  </head>
  <body>
    <!--
<textarea id="chat-log" cols="100" rows="20"></textarea><br>
    <input id="chat-message-input" type="text" size="100"><br>
    <input id="chat-message-submit" type="button" value="Send">
    <p id="channel_state"></p>
    {{ room_name|json_script:"room-name" }}


    -->

    <!-- <script>
        const roomName = JSON.parse(document.getElementById('room-name').textContent);

        
            const chatSocket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/chat/'
            + roomName
            + '/'
        );

        chatSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            document.querySelector('#chat-log').value += (data.message + '\n');
            document.getElementById('channel_state').innerHTML = data.message;
            
        };

        chatSocket.onclose = function(e) {
            console.error('Chat socket closed unexpectedly');
        };  


        document.querySelector('#chat-message-input').focus();
        document.querySelector('#chat-message-input').onkeyup = function(e) {
            if (e.keyCode === 13) {  // enter, return
                document.querySelector('#chat-message-submit').click();
            }
        };

        document.querySelector('#chat-message-submit').onclick = function(e) {
            const messageInputDom = document.querySelector('#chat-message-input');
            const message = messageInputDom.value;
            chatSocket.send(JSON.stringify({
                'message': message
            }));
            messageInputDom.value = '';
        };
    </script>
-->

<h1>Python/Django/React Application.</h1>
<h3>WebSocket Implementation, via React on the client side and Channels WebSocket Consumer on the server side.</h3>
<h3>The purpose of this simulation is to demonstrate the WebSocket functionality.  WebSocket Consumer is currently synchronous, but asynchronous capability can be implemented.</h3>
<p>The Context is the client requesting an app to open a Lighting Channel with another LN Node and the simulation of the response.</p>
<p>Page loads and automatically establishes a WebSocket.</p>
<p>Server responds and app waits for Button to be clicked to start the Open Channel process.</p>
<p>Button activation sends client request to app to simulate directing an LN Node to open a channel with another LN node.  The Open Channel request will receive a streaming response. That streaming response is simulated via time delays on the server side.  The simulated response is forwarded to the Client upon receipt via the WebSocket and React updates the status.</p>  


    <div id="asset" />
    <script type="text/javascript" src="{% static 'chat/asset-bundle.js' %}"></script>
  </body>
</html>
